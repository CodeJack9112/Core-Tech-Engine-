
# Download GLAD C loader at configure time (generator for OpenGL 4.6 core)
set(GLAD_C_URL "https://raw.githubusercontent.com/Dav1dde/glad/master/src/glad.c")
set(GLAD_H_URL "https://raw.githubusercontent.com/Dav1dde/glad/master/include/glad/glad.h")
set(GLAD_KHR_URL "https://raw.githubusercontent.com/Dav1dde/glad/master/include/KHR/khrplatform.h")
set(GLAD_C_FILE "${CMAKE_CURRENT_BINARY_DIR}/glad.c")
set(GLAD_H_FILE "${CMAKE_CURRENT_BINARY_DIR}/glad.h")
set(GLAD_KHR_FILE "${CMAKE_CURRENT_BINARY_DIR}/khrplatform.h")

if(NOT EXISTS "${GLAD_C_FILE}")
    message(STATUS "Downloading glad.c from ${GLAD_C_URL}")
    file(DOWNLOAD "${GLAD_C_URL}" "${GLAD_C_FILE}" SHOW_PROGRESS STATUS dl_status)
    list(GET dl_status 0 dl_result)
    if(NOT dl_result EQUAL 0)
        message(FATAL_ERROR "Failed to download glad.c")
    endif()
endif()
if(NOT EXISTS "${GLAD_H_FILE}")
    message(STATUS "Downloading glad.h from ${GLAD_H_URL}")
    file(DOWNLOAD "${GLAD_H_URL}" "${GLAD_H_FILE}" SHOW_PROGRESS STATUS dl_status2)
    list(GET dl_status2 0 dl_result2)
    if(NOT dl_result2 EQUAL 0)
        message(FATAL_ERROR "Failed to download glad.h")
    endif()
endif()
if(NOT EXISTS "${GLAD_KHR_FILE}")
    message(STATUS "Downloading khrplatform.h from ${GLAD_KHR_URL}")
    file(DOWNLOAD "${GLAD_KHR_URL}" "${GLAD_KHR_FILE}" SHOW_PROGRESS STATUS dl_status3)
    list(GET dl_status3 0 dl_result3)
    if(NOT dl_result3 EQUAL 0)
        message(FATAL_ERROR "Failed to download khrplatform.h")
    endif()
endif()

# Create a static library target
add_library(coretech_glad STATIC "${GLAD_C_FILE}")
target_include_directories(coretech_glad PUBLIC "${CMAKE_CURRENT_BINARY_DIR}")
